#!/bin/bash

_SPEC_DIR=$(dirname "${UBUILD_SPEC_PATH}")

# Linux kernel configuration, either set KERNEL_DEFCONFIG or KERNEL_CONFIG
KERNEL_DEFCONFIG=""
KERNEL_CONFIG="${_SPEC_DIR}/kernel/beaglebone_config"
KERNEL_MD5=$(md5sum "${KERNEL_CONFIG}")
if [ -z "${KERNEL_MD5}" ]; then
    exit 1
fi

export KERNEL_DEFCONFIG KERNEL_CONFIG KERNEL_MD5

UBOOT_DEFCONFIG="am335x_evm_config"
UBOOT_RAMDISK_ADDRESS="0x81600000"
UBOOT_RAMDISK_ENTRYPOINT="0x00000000"
UBOOT_KERNEL_ADDRESS="0x80008000"
UBOOT_KERNEL_ENTRYPOINT="${UBOOT_KERNEL_ADDRESS}"
UBOOT_IMAGE_NAME="u-boot.img"
IMAGE_TTY_DEV="/dev/ttyO0"
IMAGE_SIZE_MB="512"
UBOOT_UENV="${_SPEC_DIR}/boot/beaglebone.uEnv.txt"
if [ ! -e "${UBOOT_UENV}" ]; then
    echo "${UBOOT_UENV} not found" >&2
    exit 1
fi

IMAGE_INITRAMFS_MODULES="usb-storage sha256_generic cbc aes_generic xts"
export IMAGE_INITRAMFS_MODULES

export UBOOT_DEFCONFIG UBOOT_UENV UBOOT_IMAGE_NAME
export UBOOT_RAMDISK_ADDRESS UBOOT_RAMDISK_ENTRYPOINT
export UBOOT_KERNEL_ADDRESS UBOOT_KERNEL_ENTRYPOINT
export IMAGE_TTY_DEV IMAGE_SIZE_MB
